<div class="slide-panel" #panelEl role="dialog" aria-modal="true" aria-labelledby="panelTitle" aria-describedby="panelDescription" (keydown)="onKeydown($event)">
  <!-- Panel Header -->
  <div class="panel-header">
    <div class="panel-header-text">
      <h2 class="panel-title" id="panelTitle">Work Order Details</h2>
      <p class="panel-subtitle" id="panelDescription">Specify the dates, name and status for this order</p>
    </div>
    <div class="panel-header-actions">
      <button type="button" class="btn-header-cancel" aria-label="Cancel and close panel" (click)="onCancel()">Cancel</button>
      <button type="submit" class="btn-header-create" [attr.aria-label]="isEditMode ? 'Save work order changes' : 'Create new work order'" (click)="onSubmit()">{{ isEditMode ? 'Save' : 'Create' }}</button>
    </div>
  </div>

  <!-- Panel Body -->
  <div class="panel-body">
    <form [formGroup]="form" (ngSubmit)="onSubmit()" aria-label="Work order details form">

      <!-- Work Order Name -->
      <div class="form-field">
        <label class="field-label" for="workOrderName">Work Order Name</label>
        <input
          #nameInput
          id="workOrderName"
          type="text"
          class="field-input"
          formControlName="name"
          placeholder="Enter work order name"
          [class.has-error]="form.get('name')?.touched && form.get('name')?.invalid"
          [attr.aria-invalid]="form.get('name')?.touched && form.get('name')?.invalid"
          aria-describedby="nameError"
          autocomplete="off" />
        <div class="field-error" id="nameError" role="alert" *ngIf="form.get('name')?.touched && form.get('name')?.hasError('required')">
          Work order name is required
        </div>
      </div>

      <!-- Status -->
      <div class="form-field">
        <label class="field-label" id="statusLabel" for="statusSelect">Status</label>
        <ng-select
          class="status-select"
          [items]="statusOptions"
          bindLabel="label"
          bindValue="value"
          formControlName="status"
          [clearable]="false"
          [searchable]="false"
          appearance="outline"
          aria-labelledby="statusLabel"
          [class.has-error]="form.get('status')?.touched && form.get('status')?.invalid">

          <!-- Custom selected display (pill badge when collapsed) -->
          <ng-template ng-label-tmp let-item="item">
            <span class="status-pill" [ngClass]="getStatusClass(item.value)">
              {{ item.label }}
            </span>
          </ng-template>

          <!-- Custom dropdown option (plain text when expanded) -->
          <ng-template ng-option-tmp let-item="item">
            {{ item.label }}
          </ng-template>
        </ng-select>
      </div>

      <!-- End Date -->
      <div class="form-field">
        <label class="field-label" for="endDate">End date</label>
        <div class="date-input-wrapper" [class.has-error]="form.get('endDate')?.touched && form.get('endDate')?.invalid">
          <input
            id="endDate"
            class="field-input date-input"
            placeholder="Select end date"
            aria-label="End date"
            aria-describedby="endDateError"
            [attr.aria-invalid]="form.get('endDate')?.touched && form.get('endDate')?.invalid"
            ngbDatepicker
            #endPicker="ngbDatepicker"
            formControlName="endDate"
            (click)="endPicker.toggle()"
            readonly />
        </div>
        <div class="field-error" id="endDateError" role="alert" *ngIf="form.get('endDate')?.hasError('endBeforeStart')">
          End date must be after start date
        </div>
      </div>

      <!-- Start Date -->
      <div class="form-field">
        <label class="field-label" for="startDate">Start date</label>
        <div class="date-input-wrapper" [class.has-error]="form.get('startDate')?.touched && form.get('startDate')?.invalid">
          <input
            id="startDate"
            class="field-input date-input"
            placeholder="Select start date"
            aria-label="Start date"
            [attr.aria-invalid]="form.get('startDate')?.touched && form.get('startDate')?.invalid"
            ngbDatepicker
            #startPicker="ngbDatepicker"
            formControlName="startDate"
            (click)="startPicker.toggle()"
            readonly />
        </div>
      </div>

      <!-- Overlap Error -->
      <div class="overlap-error" role="alert" aria-live="assertive" *ngIf="overlapError">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
          <circle cx="8" cy="8" r="7" stroke="#DC2626" stroke-width="1.5"/>
          <path d="M8 4.5V8.5M8 10.5V11" stroke="#DC2626" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span>This work order overlaps with an existing order on this work center. Please adjust the dates.</span>
      </div>

    </form>
  </div>
</div>
